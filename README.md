# Ghost-Hunter-wyy
[Ghost-Hunter]:https://ghost-hunter.net9.org/ "网页"

本代码是清华大学2019年[Ghost-Hunter]比赛中wyy战队决赛使用的算法。代码略有修改，与原始代码效果上没有区别。

## 算法设计思路
1. 由于已知所有光电子产生的波形线性叠加出最终波形，算法核心在于减去已发现的波形。
2. 光电子波形的函数认为是一个RC充电过程和一个RC放电过程，通过训练集的单信号数据拟合函数参数并做平均，得到单个光电子产生的标准信号。
3. 对于待处理波形，使用阈值法可以较好得到第一个光电子抵达的时间，然后便可以减去一个标准光电子波形，该光电子波形即被减去，剩下的波形认为是剩下光电子产生的波形的叠加。
4. 如此循环往复，直至阈值法找不到光电子信号。
5. 需要注意的是有一些特殊情况需要单独处理，比如过小的信号、过于靠前的信号等等。

## 代码说明
该方法最开始使用matlab实现，提交的答案内容是使用matlab得到的。为了便于不使用matlab的用户了解代码详情、我们又使用python重新实现了该算法，效果基本一致。目前python版运行速度显著低于matlab版，需要进一步优化调整。

## MATLAB脚本运行方法
1. 将m文件、transfer.py、待处理的波形拷贝到一个目录，打开matlab并运行process.m，或在命令行中进入该目录，运行matlab -r process，生成包含答案的h5文件。
2. 使用python运行transfer.py，将matlab写出的h5文件压缩成所要求的提交格式。

## Python脚本运行方法
1. 拷贝文件到同一个目录。
2. 运行calculate.py。

## 训练集的使用
我们从训练集中挑选出了单PE波形并加了一些cut条件（波形完整且需要有一定高度），参考一些文献猜测模拟数据使用的PE波形为分段函数，分别为RC充电和RC放电。

运行fit_single_PE目录下的matlab代码'gettrainfilesparameters.m'以拟合出这些单PE波形的参数并取平均。calculate.py和calculate.m中的para变量就是这么得到的。

此外这些代码还生成了包含所有波形的PEtime、PEnumbers、索引信息的表，方便针对某一波形进行绘图分析。这些内容是整个工作的基础，对算法的最终实现起到了重要的作用，尤其是有助于找到一些“奇怪”的波形或难处理的波形以便在最终代码中加入cut条件或改变处理策略。
